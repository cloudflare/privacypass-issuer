// Generated by dts-bundle-generator v9.5.1

import { Performance as Performance$1, R2Bucket as R2Bucket$1 } from '@cloudflare/workers-types/2023-07-01';
import { WorkerEntrypoint, WorkflowEntrypoint, WorkflowEvent, WorkflowStep } from 'cloudflare:workers';

// Copyright (c) 2023 Cloudflare, Inc.
// SPDX-License-Identifier: Apache-2.0
declare global {
	// RELEASE is statically replaced at compile time by esbuild.
	// See scripts/build.js for more information.
	const RELEASE: string;
	// blindrsa requires these interface to be in scope
	// while they are available in
	interface RsaHashedKeyGenParams {
		hash: string | object;
		modulusLength: number;
		name: string;
		publicExponent: Uint8Array;
	}
	type KeyFormat = "jwk" | "pkcs8" | "raw" | "spki";
	type KeyUsage = "encrypt" | "decrypt" | "sign" | "verify" | "deriveKey" | "deriveBits" | "wrapKey" | "unwrapKey";
	// privacypass requires these interface to be in scope
	interface Algorithm {
		name: string;
	}
	type AlgorithmIdentifier = Algorithm | string;
	type HashAlgorithmIdentifier = AlgorithmIdentifier;
	interface RsaHashedImportParams extends Algorithm {
		hash: HashAlgorithmIdentifier;
	}
	interface Array<T> {
		filterMap<R>(f: (t: T) => R | null): R[];
	}
}
export interface Bindings {
	DIRECTORY_CACHE_MAX_AGE_SECONDS: string | null;
	USE_CACHE_API: string | null;
	ENVIRONMENT: string;
	SERVICE: string;
	SENTRY_ACCESS_CLIENT_ID: string | null;
	SENTRY_ACCESS_CLIENT_SECRET: string | null;
	SENTRY_DSN: string | null;
	SENTRY_SAMPLE_RATE: string | null;
	ISSUANCE_KEYS: R2Bucket$1;
	PERFORMANCE: Performance$1 | null;
	VERSION_METADATA: ScriptVersion;
	ROTATION_CRON_STRING: string | null;
	KEY_LIFESPAN_IN_MS: string;
	KEY_NOT_BEFORE_DELAY_IN_MS: string;
	MINIMUM_FRESHEST_KEYS: string | null;
	LOGGING_SHIM_TOKEN: string | null;
	WSHIM_SOCKET: Fetcher | null;
	WSHIM_ENDPOINT: string | null;
	BACKUPS_CRON_STRING: string | null;
	BACKUPS_SERVICE_ACCOUNT_KEY: string | null;
	BACKUPS_BUCKET_NAME: string | null;
	KEY_BACKUP_WF: Workflow | null;
}
export type NonNullableFields<T> = {
	[P in keyof T]: T[P] extends infer U | null ? U : T[P];
};
export type UncheckedBindings = Partial<NonNullableFields<Bindings>>;
export interface ServiceInfo {
	url: string;
	route: string;
	service: string;
}
export interface BaseRpcOptions {
	prefix?: string;
	serviceInfo: ServiceInfo;
}
export interface IssueOptions extends BaseRpcOptions {
	tokenRequest: ArrayBuffer;
	contentType: string;
}
export declare class KeyBackupWorkflow extends WorkflowEntrypoint<UncheckedBindings> {
	run(_event: WorkflowEvent<unknown>, step: WorkflowStep): Promise<void>;
}
/**
 * The response returned by the `issue()` function.
 *
 * The `notBefore` field is temporarily included to allow the
 * calculation of the expiration date.
 */
export interface IssueResponse {
	serialized: Uint8Array;
	status: number;
	responseContentType: string;
	notBefore?: number;
}
export declare class IssuerHandler extends WorkerEntrypoint<Bindings> {
	private context;
	fetch(request: Request): Promise<Response>;
	tokenDirectory(opts: BaseRpcOptions): Promise<Response>;
	issue(opts: IssueOptions): Promise<IssueResponse>;
	rotateKey(opts: BaseRpcOptions): Promise<Uint8Array>;
	clearKey(opts: BaseRpcOptions): Promise<string[]>;
	private withMetrics;
}
declare const _default: {
	fetch(request: Request, env: UncheckedBindings, ctx: ExecutionContext): Promise<Response>;
	scheduled(event: ScheduledEvent, env: UncheckedBindings, ctx: ExecutionContext): Promise<void>;
};

export {
	_default as default,
};

export {};
